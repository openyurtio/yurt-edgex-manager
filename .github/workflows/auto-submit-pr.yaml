on:
  push:
    branches:
      - main
  schedule:
    - cron: '0 2 * * *'

name: auto-collector
jobs:
  auto-createPR:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Launch auto-collector periodically  
        run: make collect
      - name: Run read-yaml action
        id: yaml-data
        uses: CumulusDS/get-yaml-paths-action@v1.0.1
        with:
          file: ./EdgeXConfig/manifest.yaml
          updated: updated
      - name: Display read-yaml output
        run: |
          echo "${{ steps.yaml-data.outputs.updated }}"
          
      - name: Create Pull Request
        if: ${{ steps.yaml-data.outputs.updated == 'true' }}
        uses: peter-evans/create-pull-request@v3
        with:
          commit-message: discover edgex new version
          title: "[auto-collector] Discover edgex new version"
          body: >
            This PR is auto-generated by github action,please check and merge the config file in time.
          labels: auto-collector, automated pr
          branch: auto-collector-generated-branch